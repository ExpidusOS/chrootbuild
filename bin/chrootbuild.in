#!/bin/bash

LIBDIR='/usr/lib/manjaro-arm-chrootbuild'

. ${LIBDIR}/util-chroot.sh
. ${LIBDIR}/util-pkg.sh

PKG_DIR=$(get_mp_conf PKGDEST)

while getopts "b:chnrs" arg; do
    case "${arg}" in
        b) BRANCH="${OPTARG}" ;;
        c) CLEAN_CHROOT=true ;;
#       i) INSTALL_PKG="${OPTARG}" ;;
        n) INSTALL=true ;;
        r) RM_PKGS=true ;;
        s) SIGNPKG=true ;;
        h|?) usage 0 ;;
        *) usage 1 ;;
    esac
done
shift $((OPTIND -1))

check_root
[[ ${RM_PKGS} = true ]] && rm_pkgs
prepare_chroot ${CHROOT_DIR}
# [[ INSTALL_PKG ]] && install_local_pkg
build_pkg ${1/\/}

# clean up, unmount chroot fs
umount -l ${CHROOT_DIR}
